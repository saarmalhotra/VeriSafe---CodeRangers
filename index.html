<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Image Detector</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TFJS + Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
            background:linear-gradient(135deg,#667eea,#764ba2);
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:20px;
        }
        .container{
            max-width:900px;width:100%;
            background:#fff;border-radius:20px;
            box-shadow:0 20px 40px rgba(0,0,0,0.2);
            overflow:hidden;
        }
        header{
            background:linear-gradient(135deg,#ff6b6b,#feca57,#48dbfb);
            color:#fff;text-align:center;padding:30px;
        }
        header h1{font-size:2.2rem;margin-bottom:8px}
        .section{padding:25px}
        .btn{
            display:inline-block;
            border:none;
            border-radius:10px;
            padding:12px 24px;
            font-size:1rem;
            font-weight:600;
            cursor:pointer;
            color:#fff;
            background:linear-gradient(135deg,#4f46e5,#7c3aed);
            transition:transform .2s,box-shadow .2s,opacity .2s;
        }
        .btn:disabled{opacity:.6;cursor:not-allowed}
        .btn:hover:not(:disabled){
            transform:translateY(-2px);
            box-shadow:0 10px 25px rgba(79,70,229,0.4);
        }
        .status{
            margin-top:15px;
            padding:10px 14px;
            border-radius:10px;
            font-size:.9rem;
            text-align:center;
            display:none;
        }
        .status.loading{background:#fef3c7;color:#92400e}
        .status.success{background:#dcfce7;color:#166534}
        .grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:20px;
            margin-top:20px;
        }
        .card{
            padding:18px;
            border-radius:15px;
            background:#f1f5f9;
            box-shadow:0 10px 25px rgba(0,0,0,0.08);
            text-align:center;
        }
        .card-title{font-weight:700;margin-bottom:12px}
        .view-box{
            width:100%;max-width:320px;height:260px;
            margin:0 auto 12px;
            border-radius:15px;
            overflow:hidden;
            background:#e5e7eb;
            display:flex;align-items:center;justify-content:center;
            color:#6b7280;font-size:.9rem;
        }
        .view-box canvas,
        .view-box img{width:100%;height:100%;object-fit:cover}
        .file-wrapper{position:relative;overflow:hidden;display:inline-block}
        .file-wrapper input[type=file]{
            position:absolute;left:0;top:0;
            opacity:0;width:100%;height:100%;cursor:pointer;
        }
        .predict-btn{
            margin-top:15px;
            width:100%;
            max-width:260px;
            background:linear-gradient(135deg,#10b981,#059669);
        }
        .results{margin-top:20px;display:none}
        .results-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
            gap:15px;
            margin-top:10px;
        }
        .result-card{
            background:#fff;
            border-radius:14px;
            padding:16px;
            box-shadow:0 8px 20px rgba(0,0,0,0.08);
            text-align:center;
        }
        .result-label{font-weight:700;margin-bottom:8px}
        .result-prob{font-size:1.8rem;font-weight:800;margin-bottom:8px;color:#4f46e5}
        .bar{
            width:100%;height:8px;border-radius:6px;
            background:#e5e7eb;overflow:hidden;
        }
        .bar-fill{
            height:100%;
            background:linear-gradient(90deg,#ef4444,#f59e0b,#10b981);
            width:0;transition:width .6s ease;
        }
        @media(max-width:768px){
            .grid{grid-template-columns:1fr}
            header h1{font-size:1.7rem}
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>VeriSafe</h1>
        <p>Classify Real vs AI-Generated Images</p>
    </header>

    <div class="section">
        <button id="initBtn" class="btn">üöÄ Start Detector</button>
        <div id="status" class="status"></div>

        <div id="ioSection" style="display:none;">
            <div class="grid">
                <div class="card">
                    <div class="card-title">üì∑ Webcam</div>
                    <div id="camBox" class="view-box">Camera not started</div>
                    <button id="camBtn" class="btn" type="button">Start Camera</button>
                </div>

                <div class="card">
                    <div class="card-title">üñºÔ∏è Upload Image</div>
                    <div id="imgBox" class="view-box">No image selected</div>
                    <div class="file-wrapper">
                        <button class="btn" type="button">Choose Image</button>
                        <input id="fileInput" type="file" accept="image/*">
                    </div>
                </div>
            </div>

            <div style="text-align:center;">
                <button id="predictBtn" class="btn predict-btn" type="button" disabled>
                     Classify
                </button>
            </div>

            <div id="results" class="results">
                <h3 style="text-align:center;">Results</h3>
                <div id="resultsGrid" class="results-grid"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // ----- CONFIG -----
    const MODEL_URL_BASE = "https://teachablemachine.withgoogle.com/models/94tkMGHCu/"; // your model

    // ----- STATE -----
    let model = null;
    let webcam = null;
    let modelReady = false;
    let webcamOn = false;
    let uploadedCanvas = null;

    // ----- DOM -----
    const initBtn      = document.getElementById("initBtn");
    const statusEl     = document.getElementById("status");
    const ioSection    = document.getElementById("ioSection");
    const camBox       = document.getElementById("camBox");
    const camBtn       = document.getElementById("camBtn");
    const fileInput    = document.getElementById("fileInput");
    const imgBox       = document.getElementById("imgBox");
    const predictBtn   = document.getElementById("predictBtn");
    const resultsEl    = document.getElementById("results");
    const resultsGrid  = document.getElementById("resultsGrid");

    // ----- HELPERS -----
    function setStatus(msg, type){
        statusEl.textContent = msg;
        statusEl.className = "status " + type;
        statusEl.style.display = "block";
    }

    // ----- INIT MODEL -----
    async function initModel(){
        try{
            setStatus("Loading model...", "loading");
            const modelURL    = MODEL_URL_BASE + "model.json";
            const metadataURL = MODEL_URL_BASE + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);  // tmImage API [web:12]
            modelReady = true;
            setStatus("Model ready!", "success");
            ioSection.style.display = "block";
            predictBtn.disabled = false;
        }catch(err){
            console.error(err);
            setStatus("Failed to load model. Check internet and retry.", "loading");
        }
    }

    // ----- WEBCAM -----
    async function toggleWebcam(){
        if(!modelReady){
            setStatus("Initialize model first.", "loading");
            return;
        }
        if(!webcamOn){
            webcam = new tmImage.Webcam(320, 260, true);
            await webcam.setup();
            await webcam.play();
            camBox.innerHTML = "";
            camBox.appendChild(webcam.canvas);
            webcamOn = true;
            camBtn.textContent = "Stop Camera";
            window.requestAnimationFrame(webcamLoop);
        }else{
            await webcam.stop();
            camBox.innerHTML = "Camera not started";
            webcamOn = false;
            camBtn.textContent = "Start Camera";
        }
    }

    async function webcamLoop(){
        if(webcamOn && webcam && modelReady){
            webcam.update();
            await predict("webcam");
            window.requestAnimationFrame(webcamLoop);
        }
    }

    // ----- IMAGE UPLOAD -----
    fileInput.addEventListener("change", e => {
        const file = e.target.files[0];
        if(!file) return;

        const img = new Image();
        img.onload = () => {
            const canvas = document.createElement("canvas");
            canvas.width  = 320;
            canvas.height = 260;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            imgBox.innerHTML = "";
            imgBox.appendChild(canvas);
            uploadedCanvas = canvas;
            predictBtn.disabled = !modelReady;
        };
        const objectURL = window.URL.createObjectURL(file); // safe alias [web:25][web:30]
        img.src = objectURL;
    });

    // ----- PREDICTION -----
    async function predict(source){
        if(!modelReady || !model) return;

        let inputEl = null;
        if(source === "webcam" && webcamOn && webcam){
            inputEl = webcam.canvas;
        }else if(uploadedCanvas){
            inputEl = uploadedCanvas;
        }else{
            return;
        }

        const preds = await model.predict(inputEl); // can take HTMLCanvasElement [web:12]
        showResults(preds);
    }

    function showResults(preds){
        resultsGrid.innerHTML = "";
        resultsEl.style.display = "block";

        preds.forEach(p => {
            const prob = (p.probability * 100).toFixed(1);
            const card = document.createElement("div");
            card.className = "result-card";
            card.innerHTML = `
                <div class="result-label">${p.className}</div>
                <div class="result-prob">${prob}%</div>
                <div class="bar"><div class="bar-fill" style="width:${prob}%"></div></div>
            `;
            resultsGrid.appendChild(card);
        });
    }

    // ----- EVENTS -----
    initBtn.onclick    = initModel;
    camBtn.onclick     = toggleWebcam;
    predictBtn.onclick = () => predict("upload");
</script>
</body>
</html>
